#!/bin/bash

SELF_PATH=$(cd -P -- "$(dirname -- "$0")" && pwd -P) && SELF_PATH=$SELF_PATH/$(basename -- "$0")

# resolve symlinks
while [ -h $SELF_PATH ]; do
	DIR=$(dirname -- "$SELF_PATH")
	SYM=$(readlink $SELF_PATH)
	SELF_PATH=$(cd $DIR && cd $(dirname -- "$SYM") && pwd)/$(basename -- "$SYM")
done

SELF_DIR=`dirname $SELF_PATH`

NITRO_HOME=`dirname $SELF_DIR`

APP_PATH=$(cd -P -- "$(dirname -- "$@")" && pwd -P) && SELF_PATH=$SELF_PATH/$(basename -- "$@")

# resolve symlinks
while [ -h $APP_PATH ]; do
	DIR=$(dirname -- "$APP_PATH")
	SYM=$(readlink $APP_PATH)
	APP_PATH=$(cd $DIR && cd $(dirname -- "$SYM") && pwd)/$(basename -- "$SYM")
done

APP_HOME=$APP_PATH

# Set the JSPATH honored by narwhal
export JSPATH="$APP_HOME/src:$APP_HOME/lib:$NITRO_HOME/src:$NITRO_HOME/lib"

if [ -e "$APP_HOME/lib" ] 
then
    export CLASSPATH="$(find $APP_HOME/lib -name '*.jar' | tr '\n' ':')$CLASSPATH" 
fi

narwhal $@
